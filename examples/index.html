<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
</head>

<body>
<div id="app">
  <router-view name="header"></router-view>

  <router-link to="/">/</router-link><br>
  <router-link to="/props-obj">/props-obj</router-link><br>
  <router-link to="/props-func/bonjour?foo=hey">/props-func/bonjour?foo=hey</router-link><br>
  <router-link to="/regex/123">/regex/123</router-link><br>
  <router-link :to="{ path: '/state', state: { foo: 'message from history.state.' } }">/state</router-link><br>
  <router-link to="/another-header">/another-header</router-link><br>
  <router-link to="/layout/foo">/layout/foo</router-link><br>
  <router-link to="/layout/bar">/layout/bar</router-link><br>
  <router-link :to="{ path: '/', hidden: true }">hidden /</router-link><br>
  <router-link :to="{ path: '/' }" method="replace">replace /</router-link><br>
  <router-link :to="{ path: '/' }" method="dispatch">dispatch /</router-link><br>
  <router-link to="/404">/404</router-link><br>
  <router-link to="/undefined-component">/undefined-component</router-link><br>
  <router-link to="/undefined-children">/undefined-children</router-link><br>

  <router-view foo="hello" class="foo"></router-view>
</div>

<script src="https://unpkg.com/vue"></script>
<script src="../HashRouter.js"></script>
<script>
Vue.use(HashRouter)

// async
const VFoo = () => Promise.resolve({
  props: ['foo', 'bar', 'baz'],
  template: '<div>foo: {{foo}}, bar: {{bar}}, baz: {{baz}}</div>'
})

const VLayoutA = {
  props: ['foo'],
  template: `
    <div>
      <p>Layout A. foo: {{foo}} <button @click="$router.setState({ foo: Math.random() })">reset</button></p>
      <router-view></router-view>
      <router-view name="footer"></router-view>
    </div>
  `
}

const routes = [
  {
    name: 'header',
    component: {
      template: '<header>Header</header>'
    }
  },

  {
    path: '/',
    component: VFoo
  },

  {
    path: '/props-obj',
    component: VFoo,
    props: { foo: 'hallo' }
  },

  {
    path: '/props-func/:bar',
    component: VFoo,
    meta: { baz: 'one' },
    props: route => ({ foo: route.query.get('foo'), bar: route.params.bar, baz: route.meta.baz })
  },

  {
    path: /^\/regex\/(\d+)$/,
    component: VFoo,
    props: route => ({ foo: route.params.$1 })
  },

  {
    path: '/state',
    component: VFoo,
    props: route => ({ foo: route.state.foo })
  },

  [
    {
      name: 'header',
      component: {
        template: '<header>Another header</header>'
      }
    },

    {
      path: '/another-header',
      component: {
        template: '<div>Using Array to group routerViews</div>'
      }
    },

    {
      component: VLayoutA,
      props: route => ({ foo: route.meta.foo }),
      children: [
        [
          {
            path: '/layout/foo',
            component: VFoo,
            meta: route => ({ foo: route.state.foo }),
            props: { foo: 'one', bar: 'two', baz: 'three' }
          },

          {
            name: 'footer',
            component: {
              template: '<footer>Another footer</footer>'
            }
          }
        ],

        {
          path: '/layout/bar',
          component: {
            template: '<div>bar</div>',
            beforeRouteLeave() {
              console.log(this)
              return confirm('Leave?')
            }
          },
          meta: { foo: 'two' },
          beforeEnter() {
            return confirm('Enter?')
          }
        },

        {
          name: 'footer',
          component: {
            template: '<footer>Footer</footer>'
          }
        }
      ]
    }
  ],

  [
    {
      name: 'header',
      component: {
        template: '<header>/undefined-component</header>'
      }
    },

    {
      path: '/undefined-component',
      beforeEnter() {
        console.log('/undefined-component')
      }
    }
  ],

  {
    path: '/undefined-children',
    component: VLayoutA
  },

  // catch-all route must be put at the last
  {
    path: '*',
    component: {
      template: '<div>404 Not Found</div>'
    }
  }
]

const router = new HashRouter({ routes })

router.beforeChange((to, from) => {
  if (from && from.path === '/layout/foo') return confirm('Leave?')
})

const app = new Vue({
  el: '#app',
  router
})

router.start()
</script>
</body>
</html>
